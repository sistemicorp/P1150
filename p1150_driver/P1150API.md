# P1150 API Reference Documentation

This document provides a technical reference for the `P1150` class and the `P1150API` constants used for controlling P1150 hardware.

---

## Constants (P1150API)

The `P1150API` dataclass contains frozen constants used for configuring various hardware modes.

### Acquisition Modes

* **`ACQUIRE_MODE_RUN`**: Continuous data streaming.
* **`ACQUIRE_MODE_SINGLE`**: Captures a single buffer of data.
* **`ACQUIRE_MODE_LOGGER`**: High-capacity logging mode.

### Triggering

* **Sources (`TRIG_SRC_*)**: `NONE`, `CUR`(Current),`D0`, `D0S`, `D1`, `A0A`.
* **Positions (`TRIG_POS_*)**: `CENTER`, `LEFT`, `RIGHT`.
* **Slopes (`TRIG_SLOPE_*)**: `RISE`, `FALL`, `EITHER`.

### Timebase Spans

Constants for setting capture duration, ranging from `TBASE_SPAN_10MS` to `TBASE_SPAN_10S`.

---

## Class: P1150

The main class for interacting with P1150 hardware. It inherits communication capabilities from `UCLogger`.

### Initialization and Connection

#### `__init__(cb_acquisition_get_data=<>, port=<>, **kw)`

Initializes the P1150 instance.

* **Parameters**:
* `cb_acquisition_get_data`: Callback function to handle incoming data buffers.
* `port`: Serial port to connect to.
* `**kw`: Arguments passed to the underlying `UCLogger` (e.g., `port`, `logger`).



#### `ez_connect(progress_callback=None)`

A high-level utility that automates the connection process, including firmware updates (if necessary) and initial calibration.

* **Parameters**: `progress_callback(progress, message)`.
* **Returns**: `(success: bool, response: dict)`.

#### `is_connected()`

Returns whether the device communication server is active.

#### `ping()`

Checks the hardware connection and returns device identification (serial, version, application mode).

#### `close()`

Gracefully shuts down the communication server and closes the serial port.

---

### Hardware Configuration

#### `set_vout(value_mv, ch=1)`

Sets the output voltage in millivolts.

#### `set_vout_remote_sense(en=False)`

Enables or disables Pseudo Remote Sense on the VOUT.

#### `set_ovc(value_ma)`

Sets the Over Current protection limit in milliamperes.

#### `probe(ch=1, connect=True, hard_connect=False, rs_comp=False)`

Controls the probe connection state.

* **Parameters**:
* `hard_connect`: If `True`, bypasses the soft-start mode. May cause high Inrush currents.
* `rs_comp`: If `True`, enables Source Resistance VOUT Compensation.



#### `set_timebase(span)`

Configures the horizontal time span for data capture.

* **Parameters**: A `P1150API.TBASE_SPAN_*` constant.

#### `set_trigger(src, pos, slope, level)`

Configures the trigger logic for data acquisition.

* **Parameters**: `level` can be an `int` (for analog sources) or a `str` (for digital sources).

---

### Data Acquisition

#### `acquisition_start(mode)`

Begins data capture in the specified mode.

#### `acquisition_stop()`

Stops/Aborts the current acquisition and clears internal buffers.

#### `acquisition_complete()`

Polls the driver to check if a triggered acquisition buffer is ready.

* **Returns**: `(True, [{"triggered": bool}])`.

#### `acquisition_get_data()`

Retrieves the most recently captured data as a dictionary of NumPy arrays.

* **Returns**: `(success, data_dict)` where `data_dict` contains keys: `t`, `i`, `a0`, `d0`, `d1`, `isnk`.

#### `adc_stream_in(item)`

The entry point for raw ADC stream data processing.

---

### Calibration and Diagnostics

#### `calibrate(force=False, blocking=True)`

Starts the device calibration routine (~20s).

* **Parameters**: `blocking` determines if the method waits for completion before returning.

#### `cal_status()`

Returns the current progress and status of the calibration routine.

#### `status()`

Retrieves the general status of the device, including temperature and error flags.

#### `vout_metrics()`

Returns hardware voltage limits (minimum, maximum, and step size).

#### `temperature_update()`

Triggers a fresh reading from the internal temperature sensor.

#### `clear_error()`

Clears active hardware error flags on the device.

#### `led_blink()`

Triggers a physical LED blink on the hardware for identification.

#### `cmd(cmd_dict)`

Sends a raw CBOR-encoded command to the target hardware.

---

### Bootloader Operations

*Used for firmware management and updates.*

#### `bootloader_init()`

Prepares the device to receive firmware blocks.

#### `bootloader_block(data)`

Sends a specific block of firmware data to the device.

#### `bootloader_done()`

Finalizes the firmware update process.

---
